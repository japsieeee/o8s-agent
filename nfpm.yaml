# nfpm configuration for o8s-agent
# https://nfpm.goreleaser.com
# vim: set ts=2 sw=2 tw=0 fo=cnqoj

name: "o8s-agent"
arch: "amd64"
platform: "linux"
version: "1.0.0"
section: "utils"
priority: "extra"

replaces:
  - old-o8s-agent

provides:
  - o8s-agent

depends:
  - nodejs
  - procps
  - coreutils
  - util-linux

recommends:
  - htop
  - iotop

suggests:
  - net-tools

conflicts:
  - other-o8s-agent

maintainer: "Jp Japos <johnlloydjapos@protonmail.com>"
description: |
  o8s agent service - lightweight server operations agent.
  Collects CPU, memory, storage, processes, and network metrics
  and sends them securely to the o8s server in real time.

vendor: "o8s-agent"
homepage: "https://deb-packages.jpjapos.com"
license: "MIT"
changelog: "changelog.yml"

contents:
  # Binary in app folder
  - src: ./dist/o8s-agent
    dst: /usr/lib/o8s-agent/o8s-agent

  # Symlink so it's executable from $PATH
  - src: /usr/lib/o8s-agent/o8s-agent
    dst: /usr/bin/o8s-agent
    type: symlink

  # License and documentation
  - src: ./LICENSE
    dst: /usr/share/doc/o8s-agent/LICENSE

  # Systemd service unit
  - src: ./o8s-agent.service
    dst: /lib/systemd/system/o8s-agent.service

  # Optional symlink for short command (if you want)
  # - src: /usr/bin/o8s-agent
  #   dst: /usr/bin/agent
  #   type: symlink

overrides:
  deb:
    scripts:
      postinstall: ./scripts/postinstall.sh
      preremove: ./scripts/preremove.sh
      postremove: ./scripts/postremove.sh
  rpm:
    scripts:
      preinstall: ./scripts/preinstall.sh
      postremove: ./scripts/postremove.sh
